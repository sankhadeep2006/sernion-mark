<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard Datasets</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .active-sidebar { color: black !important; font-weight: 600; }
    .sidebar-item { transition: color 0.15s; }
  </style>
</head>
<body class="bg-gray-50 min-h-screen text-gray-900">
  <div class="flex h-screen">
    <!-- Sidebar -->
    <div class="w-64 bg-white shadow-sm p-6 flex flex-col">
      <nav>
        <ul class="space-y-6 mt-12" id="sidebarMenu">
          <li class="flex items-center sidebar-item text-gray-600 cursor-pointer">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor">
              <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
            </svg>
            <a href="Dashboard.html">Dashboard</a>
          </li>
          <li class="flex items-center sidebar-item text-gray-600 cursor-pointer">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor">
              <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7z"/>
              <path d="M4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z"/>
            </svg>
            <a href="Projects.html">Projects</a>
          </li>
          <li data-id="datasets" class="flex items-center sidebar-item active-sidebar cursor-pointer" tabindex="0" role="button" aria-pressed="true">
            <svg class="h-5 w-5 mr-3" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path fill-rule="evenodd" d="M2 5a2 2 0 012-2h12a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V5zm3.293 1.293a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 01-1.414-1.414L7.586 10 5.293 7.707a1 1 0 010-1.414zM11 12a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
            </svg>
            Datasets
          </li>
        </ul>
      </nav>
    </div>

    <!-- Main content -->
    <main class="flex-1 px-12 py-10 flex flex-col">
      <div class="flex justify-between items-center">
        <h1 id="pageTitle" class="text-3xl font-semibold">Datasets</h1>
        <div class="flex items-center gap-5">
          <label class="text-sm text-gray-700">
            Project:
            <select id="projectSelect" class="border ml-2 px-2 py-1 rounded"></select>
          </label>
          <label class="text-sm text-gray-700">
            New Dataset:
            <input id="newDatasetName" type="text" class="border ml-2 px-2 py-1 rounded" placeholder="Dataset name" />
            <button id="createDatasetBtn" class="ml-2 bg-black text-white py-1 px-3 rounded hover:bg-gray-700">Create</button>
          </label>
          <label class="text-sm text-gray-700">
            Upload Item:
            <input id="uploadFile" type="file" class="ml-2" />
            <select id="uploadType" class="border ml-2 px-2 py-1 rounded">
              <option value="image">image</option>
              <option value="text">text</option>
              <option value="audio">audio</option>
              <option value="video">video</option>
            </select>
            <button id="uploadBtn" class="ml-2 bg-black text-white py-1 px-3 rounded hover:bg-gray-700">Upload</button>
          </label>
          <!-- Profile -->
          <div class="relative">
            <button id="profileBtn" class="flex items-center focus:outline-none">
              <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                </svg>
              </div>
            </button>
            <div id="profileDropdown" class="hidden absolute right-0 mt-2 w-64 bg-white border border-gray-200 rounded-lg shadow-lg z-50">
              <div class="p-4 flex items-center gap-3 border-b">
                <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-700">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                  </svg>
                </div>
                <div>
                  <div class="font-semibold text-base" id="userName">User</div>
                  <div class="text-sm text-gray-500" id="userEmail">user@example.com</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Filter and View Buttons -->
      <div class="flex items-center mt-8 mb-6 gap-6">
        <div class="flex gap-2">
          <button id="filter-all" class="px-4 py-1 rounded bg-gray-300 font-semibold">All</button>
          <button id="filter-recent" class="px-4 py-1 rounded bg-gray-200 font-medium">Recent</button>
          <button id="filter-completed" class="px-4 py-1 rounded bg-gray-200 font-medium">Completed</button>
        </div>
        <div class="ml-auto flex items-center gap-2">
          <button id="gridViewBtn" class="text-black bg-gray-200 px-2 py-1 rounded">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <rect x="3" y="3" width="7" height="7"/>
              <rect x="14" y="3" width="7" height="7"/>
              <rect x="14" y="14" width="7" height="7"/>
              <rect x="3" y="14" width="7" height="7"/>
            </svg>
          </button>
          <button id="listViewBtn" class="text-gray-400 bg-gray-200 px-2 py-1 rounded">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <rect x="3" y="4" width="18" height="4"/>
              <rect x="3" y="10" width="18" height="4"/>
              <rect x="3" y="16" width="18" height="4"/>
            </svg>
          </button>
        </div>
      </div>
      
      <!-- Dataset cards -->
      <div id="datasetsContainer" class="grid grid-cols-3 gap-6 flex-1 overflow-auto"></div>
    </main>
  </div>

  <!-- Dataset Modal -->
  <div id="mainModal" class="fixed inset-0 bg-black bg-opacity-20 flex items-center justify-center z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="bg-white border border-gray-300 rounded-xl shadow p-6 w-[320px] max-w-full">
      <h2 id="modalTitle" class="mb-5 text-lg font-semibold"></h2>
      <button id="editBtn" class="block w-full px-4 py-2 text-left text-sm hover:bg-gray-100 focus:outline-none"></button>
      <button id="renameBtn" class="block w-full px-4 py-2 text-left text-sm hover:bg-gray-100 focus:outline-none"></button>
      <button id="deleteBtn" class="block w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 focus:outline-none"></button>
      <button id="closeModalBtn" class="mt-5 block mx-auto bg-gray-200 hover:bg-gray-300 px-5 py-1 rounded text-gray-700 focus:outline-none">Close</button>
    </div>
  </div>

  <script src="js/api.js"></script>
  <script>
    let currentView = "grid";
    let currentFilter = "all";
    let projects = [];
    let datasets = [];
    let selectedProjectId = null;
    let selectedDatasetId = null;

    function renderDatasets() {
      const container = document.getElementById('datasetsContainer');
      container.className = currentView === 'grid' ? 'grid grid-cols-3 gap-6 flex-1 overflow-auto' : 'flex flex-col gap-4 flex-1 overflow-auto';
      const filtered = datasets; // basic filter placeholder
      container.innerHTML = filtered.map((d,i)=>`
        <div class="relative bg-white border border-gray-300 rounded-xl flex flex-col justify-between p-6 min-h-[135px]">
          <div>
            <div class="font-semibold mb-2">${d.name}</div>
            <div class="text-sm mb-1">${d.description || ''}</div>
            <div class="text-sm mb-1">Items: <span id="dsCount_${d.id}">-</span></div>
          </div>
          <div class="flex gap-2 mt-3">
            <button class="text-sm px-3 py-1 border rounded" onclick="loadItems('${d.id}')">View Items</button>
            <button class="text-sm px-3 py-1 border rounded text-red-600" onclick="deleteDataset('${d.id}')">Delete</button>
          </div>
        </div>
      `).join('');
    }

    async function loadProjects() {
      const resp = await api.getProjects();
      projects = resp.results || [];
      const sel = document.getElementById('projectSelect');
      sel.innerHTML = projects.map(p=>`<option value="${p.id}">${p.name}</option>`).join('');
      if (projects.length) {
        selectedProjectId = projects[0].id;
        sel.value = selectedProjectId;
        await loadDatasets();
      }
    }

    async function loadDatasets() {
      if (!selectedProjectId) return;
      const resp = await api.listDatasets(selectedProjectId);
      datasets = resp.results || [];
      renderDatasets();
      // fetch counts per dataset items
      // optional: list items per dataset to count
    }

    async function createDataset() {
      if (!selectedProjectId) return alert('Select a project');
      const name = document.getElementById('newDatasetName').value.trim();
      if (!name) return;
      await api.createDataset(selectedProjectId, { name });
      document.getElementById('newDatasetName').value = '';
      await loadDatasets();
    }

    async function deleteDataset(id) {
      if (!selectedProjectId) return;
      if (!confirm('Delete this dataset?')) return;
      await api.deleteDataset(selectedProjectId, id);
      await loadDatasets();
    }

    async function loadItems(datasetId) {
      selectedDatasetId = datasetId;
      const resp = await api.listItems(selectedProjectId, datasetId);
      const items = resp.results || [];
      const countEl = document.getElementById(`dsCount_${datasetId}`);
      if (countEl) countEl.textContent = items.length;
    }

    async function uploadItem() {
      if (!selectedProjectId || !selectedDatasetId) return alert('Select project and view a dataset first');
      const file = document.getElementById('uploadFile').files[0];
      const type = document.getElementById('uploadType').value;
      if (!file) return alert('Choose a file');
      await api.uploadItem(selectedProjectId, selectedDatasetId, file, type);
      await loadItems(selectedDatasetId);
    }

    document.getElementById('projectSelect').addEventListener('change', async (e)=>{
      selectedProjectId = e.target.value;
      await loadDatasets();
    });
    document.getElementById('createDatasetBtn').addEventListener('click', createDataset);
    document.getElementById('uploadBtn').addEventListener('click', uploadItem);

    document.getElementById('filter-all').onclick = function(){ currentFilter='all'; updateFilters('filter-all'); renderDatasets(); };
    document.getElementById('filter-recent').onclick = function(){ currentFilter='recent'; updateFilters('filter-recent'); renderDatasets(); };
    document.getElementById('filter-completed').onclick = function(){ currentFilter='completed'; updateFilters('filter-completed'); renderDatasets(); };
    function updateFilters(activeId){
      ['filter-all','filter-recent','filter-completed'].forEach(id=>{
        let btn=document.getElementById(id); btn.classList.remove('bg-gray-300','font-semibold'); btn.classList.add('bg-gray-200','font-medium');
      });
      let active=document.getElementById(activeId); active.classList.remove('bg-gray-200','font-medium'); active.classList.add('bg-gray-300','font-semibold');
    }
    document.getElementById('gridViewBtn').onclick=function(){ currentView='grid'; this.classList.replace('text-gray-400','text-black'); document.getElementById('listViewBtn').classList.replace('text-black','text-gray-400'); renderDatasets(); };
    document.getElementById('listViewBtn').onclick=function(){ currentView='list'; this.classList.replace('text-gray-400','text-black'); document.getElementById('gridViewBtn').classList.replace('text-black','text-gray-400'); renderDatasets(); };

    (async ()=>{
      const user = api.getCurrentUser();
      if (user) { document.getElementById('userName').textContent = user.full_name || user.username; document.getElementById('userEmail').textContent = user.email || ''; }
      updateFilters('filter-all');
      await loadProjects();
    })();
  </script>
</body>
</html>
